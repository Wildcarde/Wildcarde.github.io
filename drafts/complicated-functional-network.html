
<!DOCTYPE html>
<html lang="en">

<!-- Head -->
<head>

        <!-- Required metadata tags -->
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="HandheldFriendly" content="True" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

        <!-- Default metadata -->
    <meta name="author" content="Garrett" />
    <meta name="description" content="This is likely to end up a set of articles rather than a single one, but this is meant to be a write up on how my local network works for both my own sanity and for those trying to make a reasonably robust network. This network should work seamlessly …" />
    <meta name="keywords" content="VyOS, network, vlan, firewalls, adblock, containers, traefik">
<meta property="og:site_name" content="Putting the Pieces Together" />
<meta property="og:title" content="A Complicated but Functional Network" />
<meta property="og:description" content="This is likely to end up a set of articles rather than a single one, but this is meant to be a write up on how my local network works for both my own sanity and for those trying to make a reasonably robust network. This network should work seamlessly …" />
<meta property="og:locale" content="en_US" />
<meta property="og:url" content="https://blog.shadowgears.com/drafts/complicated-functional-network.html" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-05-15 00:00:00-04:00" />
<meta property="article:modified_time" content="" />
<meta property="article:author" content="https://blog.shadowgears.com/author/garrett.html">
<meta property="article:section" content="HowTo,Networking,syadmin" />
	<meta property="article:tag" content="VyOS" />
	<meta property="article:tag" content="network" />
	<meta property="article:tag" content="vlan" />
	<meta property="article:tag" content="firewalls" />
	<meta property="article:tag" content="adblock" />
	<meta property="article:tag" content="containers" />
	<meta property="article:tag" content="traefik" />
	<meta property="og:image" content="https://blog.shadowgears.com/">

        <!-- Site Claim -->


        <!-- Title -->
        <title>
    A Complicated but Functional Network &ndash; Putting the Pieces Together
        </title>
        
        <!-- Icon -->
        <link rel="shortcut icon" href="https://blog.shadowgears.com/favicon.ico" type="image/x-icon">
        <link rel="icon" href="https://blog.shadowgears.com/favicon.ico" type="image/x-icon">

        <!-- Search engine -->
            <meta name="robots" content="" />

        <!-- Feeds -->
            <link href="https://blog.shadowgears.com/feeds/atom.all.xml" type="application/atom+xml" rel="alternate" title="Putting the Pieces Together Full Atom Feed" />

            <link href="https://blog.shadowgears.com/feeds/rss.all.xml" type="application/rss+xml" rel="alternate" title="Putting the Pieces Together Full RSS Feed" />







        <!-- Styles -->
        <!--
        <link rel="stylesheet" href="https://ajax.aspnetcdn.com/ajax/bootstrap/4.3.1/css/bootstrap.min.css">
        -->
        <link rel="stylesheet" href="https://blog.shadowgears.com/theme/bootstrap/bootstrap.min.css">
        <!--
        <link rel="stylesheet" href="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.css">
        -->
        <link rel="stylesheet" href="https://blog.shadowgears.com/theme/pygment/friendly.min.css">
        <!--
        <link rel="stylesheet" href="https://blog.shadowgears.com/theme/extra/admonition.min.css">
        -->
        <link rel="stylesheet" href="https://blog.shadowgears.com/theme/style.css">

        <!-- Google Analytics -->
<script>
(function(i, s, o, g, r, a, m) { i['GoogleAnalyticsObject'] = r;
    i[r] = i[r] || function() {
        (i[r].q = i[r].q || []).push(arguments) }, i[r].l = 1 * new Date();
    a = s.createElement(o), m = s.getElementsByTagName(o)[0];
    a.async = 1;
    a.src = g;
    m.parentNode.insertBefore(a, m) })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
ga('create', 'UA-11921954-2', 'auto');
ga('send', 'pageview');
</script>
        <!-- Google Global Site Tag -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9D26TJ76YT"></script>
<script>
	window.dataLayer = window.dataLayer || [];
	function gtag() { dataLayer.push(arguments); }
	gtag('js', new Date());
	gtag('config', 'G-9D26TJ76YT');
</script>
        <!-- Google Tag Manager -->

        <!-- Google Adsense -->

        <!-- Heap Analytic -->

        <!-- Piwik Tracking -->

        <!-- Matomo Tracking -->

</head>

<!-- Body -->
<body class="d-flex flex-column" data-spy="scroll" data-target="#toc" data-offset="0" style="position: relative;">
    <!-- Top anchor -->
    <a href="#" id="backToTop" style="display: none; z-index: 1;" title="Back to top"><span></span></a>

    <!-- Google tag manager -->

    <!-- Navigation -->
    <nav class="flex-shrink-0 navbar navbar-expand-md navbar-expand-lg navbar-dark bg-dark text-light shadow-sm">
        <!-- Logo -->
        <a class="navbar-brand" href="https://blog.shadowgears.com"></a>

        <!-- Collapse button -->
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMenu" aria-controls="navbarMenu" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon small"></span>
        </button>

        <!-- Collapsible content -->
        <div class="collapse navbar-collapse" id="navbarMenu">

            <!-- i18n subsites -->

            <!-- Page links -->
            <ul class="navbar-nav mr-auto text-center">
                <li class="nav-item ">                           
                    <a class="nav-link" href="https://blog.shadowgears.com">
                        <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24">
                            <path d="M21 13v10h-6v-6h-6v6h-6v-10h-3l12-12 12 12h-3zm-1-5.907v-5.093h-3v2.093l3 3z" fill="currentColor"></path>
                        </svg>
                        Home <span class="sr-only">(current)</span>
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="https://blog.shadowgears.com/categories.html">
                        <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24">
                            <path d="M16 6h-8v-6h8v6zm-8 12h-8v6h8v-6zm16 0h-8v6h8v-6zm-11-7v-3h-2v3h-8v5h2v-3h14v3h2v-5h-8z" fill="currentColor"></path>
                        </svg>
                        Categories
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="https://blog.shadowgears.com/tags.html">
                        <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24">
                            <path d="M10.605 0h-10.605v10.609l13.391 13.391 10.609-10.604-13.395-13.396zm-4.191 6.414c-.781.781-2.046.781-2.829.001-.781-.783-.781-2.048 0-2.829.782-.782 2.048-.781 2.829-.001.782.782.781 2.047 0 2.829z" fill="currentColor"></path>
                        </svg>
                        Tags
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="https://blog.shadowgears.com/archives.html">
                        <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24">
                            <path d="M1.8 9l-.8-4h22l-.8 4h-2.029l.39-2h-17.122l.414 2h-2.053zm18.575-6l.604-2h-17.979l.688 2h16.687zm3.625 8l-2 13h-20l-2-13h24zm-8 4c0-.552-.447-1-1-1h-6c-.553 0-1 .448-1 1s.447 1 1 1h6c.553 0 1-.448 1-1z" fill="currentColor"></path>
                        </svg>
                        Archives
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="https://blog.shadowgears.com/pages/about.html">
                        <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24">
                            <path d="M20.822 18.096c-3.439-.794-6.64-1.49-5.09-4.418 4.72-8.912 1.251-13.678-3.732-13.678-5.082 0-8.464 4.949-3.732 13.678 1.597 2.945-1.725 3.641-5.09 4.418-3.073.71-3.188 2.236-3.178 4.904l.004 1h23.99l.004-.969c.012-2.688-.092-4.222-3.176-4.935z" fill="currentColor"></path>
                        </svg>
                        About
                    </a>
                </li>
            </ul>

            <!-- Search form 
            <form class="form-inline text-center" action="https://blog.shadowgears.com/search.html">
                <input class="form-control w-100 bg-dark text-light text-center border-0 p-2" type="text" name="q" pattern=".{3,}" title="At least 3 characters" required="" placeholder="Type here to search" aria-label="Search">
            </form>-->

            <!-- Social links -->
            <ul class="navbar-nav text-center">
                <li class="nav-item">
                    <a class="nav-link" href="https://github.com/wildcarde">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                            <title>Github</title>
                            <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z" fill="currentColor"></path>
                        </svg>
                    </a>
                </li>
            </ul>
        </div>
    </nav>

    <!-- Full page -->
    <div class="flex-shrink-0 flex-grow-1">

        <!-- Header -->
        <header class="bg-dark text-light shadow-sm pt-3 pb-2">
	<div class="container">
		<h3 id="complicated-functional-network">A Complicated but Functional&nbsp;Network</h3>
		<p style="font-size:larger;"><p>This is likely to end up a set of articles rather than a single one, but this is meant to be a write up on how my local network works for both my own sanity and for those trying to make a reasonably robust network. This network should work seamlessly …</p></p>
        <div class="row mx-auto mt-3">
            <div class="col-xs-12 col-sm-12 col-md-6 text-left" style="padding: 0">
                <a href="https://blog.shadowgears.com/author/garrett.html" class="card-link">Garrett</a>
                <span class="card-link text-success">
                    <span class="post-date" title="Post date">Wed 15 May 2024</span>
                    <span class="text-info modified-date" title="Updated date">
                            Wed 15 May 2024
                    </span>
                </span>
            </div>
            <div class="col-xs-12 col-sm-12 col-md-6 text-right" style="padding: 0">
                <a class="badge badge-success" href="https://blog.shadowgears.com/category/howtonetworkingsyadmin.html">howto,networking,syadmin</a>
                    <a class="badge badge-info" href="https://blog.shadowgears.com/tag/vyos.html">vyos</a>
                    <a class="badge badge-info" href="https://blog.shadowgears.com/tag/network.html">network</a>
                    <a class="badge badge-info" href="https://blog.shadowgears.com/tag/vlan.html">vlan</a>
                    <a class="badge badge-info" href="https://blog.shadowgears.com/tag/firewalls.html">firewalls</a>
                    <a class="badge badge-info" href="https://blog.shadowgears.com/tag/adblock.html">adblock</a>
                    <a class="badge badge-info" href="https://blog.shadowgears.com/tag/containers.html">containers</a>
                    <a class="badge badge-info" href="https://blog.shadowgears.com/tag/traefik.html">traefik</a>
            </div>
        </div>
	</div>
        </header>

        <!-- Main -->
        <main class="py-3">
                <div class="container">
                    <!-- Sharing -->

                    <!-- Content -->
    <!-- 2 columns layout -->
    <!-- single column layout -->
        <!-- Sharing -->

        <!-- Share post -->

        <!-- Article -->
        <div>
            <p>This is likely to end up a set of articles rather than a single one, but this is meant to be a write up on how my local network works for both my own sanity and for those trying to make a reasonably robust network. This network should work seamlessly with computers, mobile devices, and other table top devices without individual configurations. Specifically you will not need to do things like setup a certificate authority, directly manage certs, do host level configuration to enable hostnames, or ideally make any client level changes to make them play nice with each other or the wider&nbsp;internet.</p>
<p>Many of these things can be handled in a variety of ways but I&#8217;ll be recording specifically how things are done in&nbsp;setup.</p>
<h2 id="structural-notes">Structural&nbsp;Notes</h2>
<p>I use a series of subdomains to logically organize my network under a single top level domain. You could however do this as a single domain if you so chose, that&#8217;s purely an organizational&nbsp;decision.</p>
<p>The way this system is setup is using a VyOS box as the router for the gateway out of the network, this will also act as a firewall, vpn host target, and ad filtering solution. These responsibilities can be moved elsewhere but if the router is sufficiently powerful keeping at least the vpn endpoint on it is strongly advised for simplicity and keeping the adblocking service local means one less back and forth trip to another device in order for that functionality to be&nbsp;achieved.</p>
<p>The VyOS router configured its out going connection via <span class="caps">DHCP</span> in my config but if you have a static ip you&#8217;ll need to configure that using the related docs. Over top it is hosted a wireguard vpn network that allowed remote access, a container running pihole to manage dns blocking, and HAProxy to act as a http/https router to some of my internal services, and firewall controls to make sure dns and access are obeyed as expected. While the HAProxy could be replaced with traefik, it&#8217;s a configuration I ported forward from previous setups so I left it &#8216;as is&#8217; for&nbsp;now.</p>
<h2 id="things-you-need-before-you-start">Things you need before you&nbsp;start</h2>
<ul>
<li>A dedicated domain you own and&nbsp;control</li>
<li><span class="caps">API</span> access to that domain so you can make <span class="caps">TXT</span> records automatically as well as DynDNS&nbsp;updates</li>
<li>A dedicated device to host the router&nbsp;software</li>
<li>A managed network switch or multiple ports for use as internal&nbsp;subnetworks</li>
<li>A set of <span class="caps">IP</span> ranges to use, I use 4 but depending on what you are planning you may need more or&nbsp;less</li>
</ul>
<h2 id="getting-started">Getting&nbsp;Started</h2>
<p>First things first you need to get a VyOS configuration built and configured. This is easier than it appears on the surface but will require familiarizing yourself with the VyOS online documentation and build&nbsp;instructions.</p>
        </div>

        <!-- Neighbors -->

        <!-- Google Adsense -->

    <!-- Releated posts -->
        <hr>
        <div>
            <h5>Related posts:</h5>
            <ul>
                <li><a href="https://blog.shadowgears.com/vyos-and-tailscale-friendnets.html">Using VyOS and Tailscale to build a Friends and Family Sharing&nbsp;Network</a></li>
            </ul>
        </div>

    <!-- Comments -->
                </div>
        </main>

    </div>

    <!-- Footer -->
    <footer class="flex-shrink-0 bg-dark text-light small py-1">
        <div class="container text-center">
            &copy;  <a href="https://blog.shadowgears.com">Putting the Pieces Together</a> by <a href="https://blog.shadowgears.com/pages/about.html">Garrett</a>. Powered by <a href="http://getpelican.com">Pelican</a>, <a href="http://python.org">Python</a>, <a href="https://getbootstrap.com">Bootstrap 4</a><br>
            <!-- Do not remove below license sentence -->
            License: <a href="https://spdx.org/licenses/CC-BY-4.0.html">CC-BY-4.0</a>, based on <a href="https://github.com/vuquangtrong/simplify-theme">Simplify Bootstrap Theme</a>
        </div>
    </footer>

    <!-- Scripts -->
    <!--
    <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.4.1.min.js"></script>
    -->
    <script type="text/javascript" src="https://blog.shadowgears.com/theme/jquery/jquery-3.4.1.min.js"></script>
    <!--
    <script src="https://ajax.aspnetcdn.com/ajax/bootstrap/4.3.1/bootstrap.min.js"></script>
    -->
    <script type="text/javascript" src="https://blog.shadowgears.com/theme/bootstrap/bootstrap.min.js"></script>
    <!--
    <script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script>
    -->
    <script type="text/javascript" src="https://blog.shadowgears.com/theme/style.js"></script>

    <!-- Sharing -->

    <!-- JSON LD -->
<script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "name": "A Complicated but Functional Network",
    "headline": "A Complicated but Functional Network",
    "datePublished": "2024-05-15 00:00:00-04:00",
    "dateModified": "",
    "author": {
        "@type": "Person",
        "name": "Garrett",
        "url": "https://blog.shadowgears.com/author/garrett.html"
    },
    "image": "https://blog.shadowgears.com/favicon.ico",
    "url": "https://blog.shadowgears.com/drafts/complicated-functional-network.html",
    "description": "This is likely to end up a set of articles rather than a single one, but this is meant to be a write up on how my local network works for both my own sanity and for those trying to make a reasonably robust network. This network should work seamlessly …"
}
</script>
    <!-- Disqus count -->
</body>

</html>