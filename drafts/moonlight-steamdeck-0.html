<!DOCTYPE html>
<html lang="en">
<head>
          <title>Putting the Pieces Together</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta charset="utf-8" />
        <!-- twitter card metadata -->
<meta name="twitter:site" content="@Wildcarde815">
<meta name="twitter:title" content="Setting up Moonlight and Sunshine to Stream to Steamdeck">
<meta name="twitter:description" content="">
        <!-- OG Tags -->
<meta property="og:url" content="https://blog.shadowgears.com/drafts/moonlight-steamdeck-0.html"/>
<meta property="og:title" content="Putting the Pieces Together | Setting up Moonlight and Sunshine to Stream to Steamdeck" />
<meta property="og:description" content="" />
        <!-- favicon -->
        <!-- moment.js for date formatting -->
        <script src="https://blog.shadowgears.com/theme/js/moment.js"></script>
        <!-- css -->
        <link rel="stylesheet" type="text/css" href="https://blog.shadowgears.com/theme/css/main.css" />
		<script>
			
                /*! grunt-grunticon Stylesheet Loader - v2.1.2 | https://github.com/filamentgroup/grunticon | (c) 2015 Scott Jehl, Filament Group, Inc. | MIT license. */
    
    (function(e){function t(t,n,r,o){"use strict";function a(){for(var e,n=0;u.length>n;n++)u[n].href&&u[n].href.indexOf(t)>-1&&(e=!0);e?i.media=r||"all":setTimeout(a)}var i=e.document.createElement("link"),l=n||e.document.getElementsByTagName("script")[0],u=e.document.styleSheets;return i.rel="stylesheet",i.href=t,i.media="only x",i.onload=o||null,l.parentNode.insertBefore(i,l),a(),i}var n=function(r,o){"use strict";if(r&&3===r.length){var a=e.navigator,i=e.Image,l=!(!document.createElementNS||!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect||!document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Image","1.1")||e.opera&&-1===a.userAgent.indexOf("Chrome")||-1!==a.userAgent.indexOf("Series40")),u=new i;u.onerror=function(){n.method="png",n.href=r[2],t(r[2])},u.onload=function(){var e=1===u.width&&1===u.height,a=r[e&&l?0:e?1:2];n.method=e&&l?"svg":e?"datapng":"png",n.href=a,t(a,null,null,o)},u.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",document.documentElement.className+=" grunticon"}};n.loadCSS=t,e.grunticon=n})(this);(function(e,t){"use strict";var n=t.document,r="grunticon:",o=function(e){if(n.attachEvent?"complete"===n.readyState:"loading"!==n.readyState)e();else{var t=!1;n.addEventListener("readystatechange",function(){t||(t=!0,e())},!1)}},a=function(e){return t.document.querySelector('link[href$="'+e+'"]')},c=function(e){var t,n,o,a,c,i,u={};if(t=e.sheet,!t)return u;n=t.cssRules?t.cssRules:t.rules;for(var l=0;n.length>l;l++)o=n[l].cssText,a=r+n[l].selectorText,c=o.split(");")[0].match(/US\-ASCII\,([^"']+)/),c&&c[1]&&(i=decodeURIComponent(c[1]),u[a]=i);return u},i=function(e){var t,o,a;o="data-grunticon-embed";for(var c in e)if(a=c.slice(r.length),t=n.querySelectorAll(a+"["+o+"]"),t.length)for(var i=0;t.length>i;i++)t[i].innerHTML=e[c],t[i].style.backgroundImage="none",t[i].removeAttribute(o);return t},u=function(t){"svg"===e.method&&o(function(){i(c(a(e.href))),"function"==typeof t&&t()})};e.embedIcons=i,e.getCSS=a,e.getIcons=c,e.ready=o,e.svgLoadedCallback=u,e.embedSVG=u})(grunticon,this);
                
                grunticon(["https://blog.shadowgears.com/theme/css/icons.data.svg.css", "https://blog.shadowgears.com/theme/css/icons.data.png.css", "https://blog.shadowgears.com/theme/css/icons.fallback.css"]);
            </script>
        <noscript><link href="https://blog.shadowgears.com/theme/css/icons.fallback.css" rel="stylesheet"></noscript>
        <!-- menu toggle javascript -->
        <script type="text/javascript">
            document.addEventListener("DOMContentLoaded", initMenu);
            
            function initMenu(){
                var menu = document.getElementById("menu");
                var menulink = document.getElementById("menu-link");
                menulink.addEventListener("click", function toggleMenu(){
                        window.event.preventDefault();
                        menulink.classList.toggle('active');
                        menu.classList.toggle('active');              
                    });
            };
        </script>


    <meta name="tags" content="deployment" />
    <meta name="tags" content="blog" />

</head>
<body>
    <div role="banner" id="masthead">
        <header>
            <h1><a href="/">Garrett's Blog</a></h1>
            <a href="#menu" id="menu-link">more stuff</a>
            <nav id="menu">
                <ul>
                            <li><a href="https://blog.shadowgears.com/category/glass-canopy.html">Glass Canopy</a></li>
                            <li class="active"><a href="https://blog.shadowgears.com/category/howto.html">HowTo</a></li>
                </ul>
            </nav>
        </header>
    </div>
        <div class="page" role="main">
  <div class="article" role="article">
    <article>
        <footer>
            <a name="top"></a>
            <p>
              <time datetime=" 2023-09-14 00:00:00-04:00">
                <script>document.write(moment('2023-09-14 00:00:00-04:00').format('LL'));</script>
              </time>
            </p>
        </footer>
        <header>
          <h2>
            Setting up Moonlight and Sunshine to Stream to Steamdeck
          </h2>
        </header>
      <div class="content">
         <h1>The Problem</h1>
<p>While Steam streaming and Sunshine are both pretty straight forward to configure if you don't ask much from them, getting them to play nice with a 3 screen computer setup is a relatively poor experience.  This is doubly true if the main screen in use is an ultrawide as these tools do not change the aspect ratio or screen behaviors when streaming out of the box. So when you have a screen setup that looks like a Tie Fighter it is a less than ideal experience between sunshine and moonlight. Lets solve that!</p>
<h1>The Goal</h1>
<p>When you initiate a connection to sunshine from moonlight on the steamdeck the system should automatically configure the windows PC. This includes disabling secondary displays and adjusting the resolution to match the steamdeck.  When the moonlight connection is terminated, roll back these changes and restore the screens to their default resolution and state.</p>
<h2>Prereqs</h2>
<p>There's a few things we are going to take for granted here to start.</p>
<ul>
<li>You (the reader) have an up to date copy of sunshine installed on your desktop of choice.</li>
<li>The basics of this are covered in the <a href="https://docs.lizardbyte.dev/projects/sunshine/en/latest/about/installation.html">sunshine docs</a>.</li>
<li>You have a copy of moonlight installed and configured as a tile on your steamdeck.</li>
<li>This is covered extensively in blog posts and YouTube videos the world over, <a href="https://pimylifeup.com/steam-deck-moonlight/">this was the first google hit for me and looks to be a solid explanation</a>.</li>
<li>A copy of NirSoft's <a href="https://www.nirsoft.net/utils/multi_monitor_tool.html">Multi-Monitor Tool</a>.</li>
<li>This should be placed somewhere you can easily locate and reliably find.  I put it inside a folder simply labeled 'programs' in my home directory.</li>
<li>A piece of software you want to make work by streaming to your steamdeck, I'll be using <a href="https://playnite.link/">Playnite</a> as it lets me aggregate all my desktop game stores into one library interface.</li>
</ul>
<h2>Details to have in front of you before you start</h2>
<ul>
<li>Full drive path to your program folder, for example: <code>C:\Users\&lt;username&gt;\Programs\</code></li>
<li>Additionally make note of where MultiMonitorTool is, ie: <code>C:\Users\&lt;username&gt;\Programs\multimonitortool-x64\</code></li>
<li>How many monitors you have, for example: <code>3</code></li>
<li>The full path to the executable you want to run, for example for playnite: <code>C:\Users\&lt;username&gt;\AppData\Local\Playnite\Playnite.Fullscreenapp.exe</code></li>
<li>The working directory you want the program to run in, some applications don't care but playnite does so: <code>C:\Users\&lt;username&gt;\AppData\Local\Playnite\</code></li>
</ul>
<h1>HowTo</h1>
<p>The basic gist of this is that we are going to use MultiMonitorTool to capture our default configuration, and then the configuration we want for when things are streamed out to the steam deck as configuration files.  Once these are captured we'll use a set of batch scripts to swap the two modes back and forth automatically.</p>
<h2>Capture Monitor Configurations</h2>
<p>To get started, in the windows display settings configure your screens as you would like them to be by default. After this is set start up the multimonitortool gui and you'll see a window similar to below.</p>
<p><img alt="multimonitor all screens enabled" src="/images/2023-multimon-all.png"></p>
<h2>Start Script</h2>
<div class="highlight"><pre><span></span><code><span class="p">:</span><span class="c1">: disable secondary monitors and switch main monitor to steamdeck native resolution</span>
<span class="p">:</span><span class="c1">:</span>
<span class="p">@</span><span class="k">ECHO</span> OFF
<span class="k">cd</span> C:\Users\<span class="p">&lt;</span>username<span class="p">&gt;</span>\Programs\multimonitortool-x64
.\MultiMonitorTool.exe /disable 2 3
.\MultiMonitorTool.exe /LoadConfig ./steamdeck-native.cfg
timeout /t 2
</code></pre></div>


<h2>Exit Script</h2>
<div class="highlight"><pre><span></span><code><span class="p">:</span><span class="c1">:reset the monitor configuration to default</span>
<span class="p">:</span><span class="c1">:</span>
<span class="p">@</span><span class="k">ECHO</span> OFF
<span class="k">cd</span> C:\Users\<span class="p">&lt;</span>username<span class="p">&gt;</span>\Programs\multimonitortool-x64
.\MultiMonitorTool.exe /LoadConfig ./default.cfg
.\MultiMonitorTool.exe /LoadConfig ./default.cfg
</code></pre></div>


<h2>Putting it Together in an Application Entry</h2>
      </div>
      <div class="back-to-top">
          <a href="#top">back to top</a>
      </div>
    </article>
  </div>
<!-- end article -->
                <footer>
                    <div class="icons">
                        <a href="https://twitter.com/Wildcarde815" target="_blank"><div class="icon-twitter icon"></div></a>
                        <a href="https://github.com/Wildcarde" target="_blank"><div class="icon-github icon"></div></a>
                    </div>
                    <p>© <script>document.write(moment().format('YYYY'));</script> Garrett McGrath</p>
 
                    <p><i>"Brutal"</i> Pelican Theme</p>
                    <p>Designed and built by <a href="http://twitter.com/mcman_s">@mcman_s</a> in Denver</p>
                </footer>
        </div>
</body>
</html>