
<!DOCTYPE html>
<html lang="en">

<!-- Head -->
<head>

        <!-- Required metadata tags -->
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="HandheldFriendly" content="True" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

        <!-- Default metadata -->
    <meta name="author" content="Garrett" />
    <meta name="description" content="Defining the problem space I’ve been working on digitally ‘battening down the hatches’ a bit at my house and trying to solve some access challenges that have been bothering me. Specifically being able to share access to applications I’ve got running in my home to friends that want …" />
    <meta name="keywords" content="vyos, network, firewall, acl">
<meta property="og:site_name" content="Putting the Pieces Together" />
<meta property="og:title" content="Using VyOS and Tailscale to build a Friends and Family Sharing Network" />
<meta property="og:description" content="Defining the problem space I’ve been working on digitally ‘battening down the hatches’ a bit at my house and trying to solve some access challenges that have been bothering me. Specifically being able to share access to applications I’ve got running in my home to friends that want …" />
<meta property="og:locale" content="en_US" />
<meta property="og:url" content="https://blog.shadowgears.com/drafts/vyos-and-tailscale-friendnets.html" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-09-27 00:00:00-04:00" />
<meta property="article:modified_time" content="" />
<meta property="article:author" content="https://blog.shadowgears.com/author/garrett.html">
<meta property="article:section" content="sysadmin,HowTo" />
	<meta property="article:tag" content="vyos" />
	<meta property="article:tag" content="network" />
	<meta property="article:tag" content="firewall" />
	<meta property="article:tag" content="acl" />
	<meta property="og:image" content="https://blog.shadowgears.com/">

        <!-- Site Claim -->


        <!-- Title -->
        <title>
    Using VyOS and Tailscale to build a Friends and Family Sharing Network &ndash; Putting the Pieces Together
        </title>
        
        <!-- Icon -->
        <link rel="shortcut icon" href="https://blog.shadowgears.com/favicon.ico" type="image/x-icon">
        <link rel="icon" href="https://blog.shadowgears.com/favicon.ico" type="image/x-icon">

        <!-- Search engine -->
            <meta name="robots" content="" />

        <!-- Feeds -->
            <link href="https://blog.shadowgears.com/feeds/atom.all.xml" type="application/atom+xml" rel="alternate" title="Putting the Pieces Together Full Atom Feed" />

            <link href="https://blog.shadowgears.com/feeds/rss.all.xml" type="application/rss+xml" rel="alternate" title="Putting the Pieces Together Full RSS Feed" />







        <!-- Styles -->
        <!--
        <link rel="stylesheet" href="https://ajax.aspnetcdn.com/ajax/bootstrap/4.3.1/css/bootstrap.min.css">
        -->
        <link rel="stylesheet" href="https://blog.shadowgears.com/theme/bootstrap/bootstrap.min.css">
        <!--
        <link rel="stylesheet" href="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.css">
        -->
        <link rel="stylesheet" href="https://blog.shadowgears.com/theme/pygment/friendly.min.css">
        <!--
        <link rel="stylesheet" href="https://blog.shadowgears.com/theme/extra/admonition.min.css">
        -->
        <link rel="stylesheet" href="https://blog.shadowgears.com/theme/style.css">

        <!-- Google Analytics -->
<script>
(function(i, s, o, g, r, a, m) { i['GoogleAnalyticsObject'] = r;
    i[r] = i[r] || function() {
        (i[r].q = i[r].q || []).push(arguments) }, i[r].l = 1 * new Date();
    a = s.createElement(o), m = s.getElementsByTagName(o)[0];
    a.async = 1;
    a.src = g;
    m.parentNode.insertBefore(a, m) })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
ga('create', 'UA-11921954-2', 'auto');
ga('send', 'pageview');
</script>
        <!-- Google Global Site Tag -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9D26TJ76YT"></script>
<script>
	window.dataLayer = window.dataLayer || [];
	function gtag() { dataLayer.push(arguments); }
	gtag('js', new Date());
	gtag('config', 'G-9D26TJ76YT');
</script>
        <!-- Google Tag Manager -->

        <!-- Google Adsense -->

        <!-- Heap Analytic -->

        <!-- Piwik Tracking -->

        <!-- Matomo Tracking -->

</head>

<!-- Body -->
<body class="d-flex flex-column" data-spy="scroll" data-target="#toc" data-offset="0" style="position: relative;">
    <!-- Top anchor -->
    <a href="#" id="backToTop" style="display: none; z-index: 1;" title="Back to top"><span></span></a>

    <!-- Google tag manager -->

    <!-- Navigation -->
    <nav class="flex-shrink-0 navbar navbar-expand-md navbar-expand-lg navbar-dark bg-dark text-light shadow-sm">
        <!-- Logo -->
        <a class="navbar-brand" href="https://blog.shadowgears.com"></a>

        <!-- Collapse button -->
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMenu" aria-controls="navbarMenu" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon small"></span>
        </button>

        <!-- Collapsible content -->
        <div class="collapse navbar-collapse" id="navbarMenu">

            <!-- i18n subsites -->

            <!-- Page links -->
            <ul class="navbar-nav mr-auto text-center">
                <li class="nav-item ">                           
                    <a class="nav-link" href="https://blog.shadowgears.com">
                        <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24">
                            <path d="M21 13v10h-6v-6h-6v6h-6v-10h-3l12-12 12 12h-3zm-1-5.907v-5.093h-3v2.093l3 3z" fill="currentColor"></path>
                        </svg>
                        Home <span class="sr-only">(current)</span>
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="https://blog.shadowgears.com/categories.html">
                        <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24">
                            <path d="M16 6h-8v-6h8v6zm-8 12h-8v6h8v-6zm16 0h-8v6h8v-6zm-11-7v-3h-2v3h-8v5h2v-3h14v3h2v-5h-8z" fill="currentColor"></path>
                        </svg>
                        Categories
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="https://blog.shadowgears.com/tags.html">
                        <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24">
                            <path d="M10.605 0h-10.605v10.609l13.391 13.391 10.609-10.604-13.395-13.396zm-4.191 6.414c-.781.781-2.046.781-2.829.001-.781-.783-.781-2.048 0-2.829.782-.782 2.048-.781 2.829-.001.782.782.781 2.047 0 2.829z" fill="currentColor"></path>
                        </svg>
                        Tags
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="https://blog.shadowgears.com/archives.html">
                        <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24">
                            <path d="M1.8 9l-.8-4h22l-.8 4h-2.029l.39-2h-17.122l.414 2h-2.053zm18.575-6l.604-2h-17.979l.688 2h16.687zm3.625 8l-2 13h-20l-2-13h24zm-8 4c0-.552-.447-1-1-1h-6c-.553 0-1 .448-1 1s.447 1 1 1h6c.553 0 1-.448 1-1z" fill="currentColor"></path>
                        </svg>
                        Archives
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="https://blog.shadowgears.com/pages/about.html">
                        <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24">
                            <path d="M20.822 18.096c-3.439-.794-6.64-1.49-5.09-4.418 4.72-8.912 1.251-13.678-3.732-13.678-5.082 0-8.464 4.949-3.732 13.678 1.597 2.945-1.725 3.641-5.09 4.418-3.073.71-3.188 2.236-3.178 4.904l.004 1h23.99l.004-.969c.012-2.688-.092-4.222-3.176-4.935z" fill="currentColor"></path>
                        </svg>
                        About
                    </a>
                </li>
            </ul>

            <!-- Search form 
            <form class="form-inline text-center" action="https://blog.shadowgears.com/search.html">
                <input class="form-control w-100 bg-dark text-light text-center border-0 p-2" type="text" name="q" pattern=".{3,}" title="At least 3 characters" required="" placeholder="Type here to search" aria-label="Search">
            </form>-->

            <!-- Social links -->
            <ul class="navbar-nav text-center">
                <li class="nav-item">
                    <a class="nav-link" href="https://github.com/wildcarde">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                            <title>Github</title>
                            <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z" fill="currentColor"></path>
                        </svg>
                    </a>
                </li>
            </ul>
        </div>
    </nav>

    <!-- Full page -->
    <div class="flex-shrink-0 flex-grow-1">

        <!-- Header -->
        <header class="bg-dark text-light shadow-sm pt-3 pb-2">
	<div class="container">
		<h3 id="vyos-and-tailscale-friendnets">Using VyOS and Tailscale to build a Friends and Family Sharing&nbsp;Network</h3>
		<p style="font-size:larger;"><h1 id="defining-the-problem-space">Defining the problem&nbsp;space</h1>
<p>I&#8217;ve been working on digitally &#8216;battening down the hatches&#8217; a bit at my house and trying to solve some access challenges that have been bothering me. Specifically being able to share access to applications I&#8217;ve got running in my home to friends that want …</p></p>
        <div class="row mx-auto mt-3">
            <div class="col-xs-12 col-sm-12 col-md-6 text-left" style="padding: 0">
                <a href="https://blog.shadowgears.com/author/garrett.html" class="card-link">Garrett</a>
                <span class="card-link text-success">
                    <span class="post-date" title="Post date">Sat 27 September 2025</span>
                    <span class="text-info modified-date" title="Updated date">
                            Sat 27 September 2025
                    </span>
                </span>
            </div>
            <div class="col-xs-12 col-sm-12 col-md-6 text-right" style="padding: 0">
                <a class="badge badge-success" href="https://blog.shadowgears.com/category/sysadminhowto.html">sysadmin,howto</a>
                    <a class="badge badge-info" href="https://blog.shadowgears.com/tag/vyos.html">vyos</a>
                    <a class="badge badge-info" href="https://blog.shadowgears.com/tag/network.html">network</a>
                    <a class="badge badge-info" href="https://blog.shadowgears.com/tag/firewall.html">firewall</a>
                    <a class="badge badge-info" href="https://blog.shadowgears.com/tag/acl.html">acl</a>
            </div>
        </div>
	</div>
        </header>

        <!-- Main -->
        <main class="py-3">
                <div class="container">
                    <!-- Sharing -->

                    <!-- Content -->
    <!-- 2 columns layout -->
    <!-- single column layout -->
        <!-- Sharing -->

        <!-- Share post -->

        <!-- Article -->
        <div>
            <h1 id="defining-the-problem-space">Defining the problem&nbsp;space</h1>
<p>I&#8217;ve been working on digitally &#8216;battening down the hatches&#8217; a bit at my house and trying to solve some access challenges that have been bothering me. Specifically being able to share access to applications I&#8217;ve got running in my home to friends that want to use them (copyparty, minecraft, etc.). Initially I attempted to use straight wireguard to handle this; it&#8217;s reasonably easy to use, but debugging other peoples configurations is a fairly huge pain in the ass if you aren&#8217;t doing a remote support session with them at the same time. Updating configs is also challenging as it means sending new config files out to everyone, this isn&#8217;t a huge deal in a managed environment but isn&#8217;t really workable when passing things to people over discord. So, an alternative solution had to be&nbsp;found.</p>
<h1 id="changing-my-approach">Changing My&nbsp;Approach</h1>
<p>Instead of having them each manually setup wireguard I decided to finally give tailscale a whirl and see if I could get it doing what I wanted. This comes with some challenges around the fact that unlike wireguard itself, tailscale is not a native interface for VyOS my router <span class="caps">OS</span> of choice. To resolve this you have two choices, either update the iso image to include the relevant modules; this is non trivial and has been made more complicated with their recent build changes, or use a container. We will be pursuing the second option in this&nbsp;article.</p>
<h1 id="assumptions">Assumptions</h1>
<ul>
<li>You have a functioning VyOS install you want to use as an exit&nbsp;node</li>
<li>You have already setup a Tailscale&nbsp;account</li>
<li>You understand what a container&nbsp;is</li>
<li>You have already created a container network in VYos and added it to a firewall&nbsp;zone</li>
<li>You don&#8217;t care about IPv6, I don&#8217;t bother including it here as it&#8217;s utility is limitted for most&nbsp;people.</li>
<li>Also, if you do care I assume you can figure out that part&nbsp;yourself</li>
</ul>
<h1 id="initial-setup-steps">Initial setup&nbsp;steps</h1>
<p>The vyos side of this is drawn from the excellent if brief post on the VYos forums found here:&nbsp;https://forum.vyos.io/t/tailscale-subnet-router-with-container-networking/15091</p>
<p>While this post is great, it lacks some of the context and &#8216;why&#8217; for the configs being presented and what you&#8217;d need to replace for your own&nbsp;setup.</p>
<h2 id="required-initial-details">Required Initial&nbsp;Details</h2>
<p>First you will need to gather some specific information needed to get this all setup. I recommend having these written down before hand so you can just plug them in as you&nbsp;go.</p>
<ul>
<li>Vyos Container <span class="caps">IP</span>:<ul>
<li>This is the ip you&#8217;ll use internally on the container network as the <span class="caps">IP</span> of your tailscale&nbsp;&#8216;device&#8217;.</li>
</ul>
</li>
<li>Routes you wish to expose:<ul>
<li>This is the ip ranges you wish to be visible from the tailscale side. For example if you wanted ips&nbsp;on <code>192.168.100.*</code> to be reachable, you&#8217;d&nbsp;use <code>192.168.100.0/24</code> (using <span class="caps">CIDR</span>&nbsp;notation)</li>
</ul>
</li>
<li>A Tailscale Auth Key<ul>
<li>This is generated via the tailscale website. You&#8217;ll find the place to create them under the &#8216;Settings&#8217; tab at the top, if you click on the &#8216;Keys&#8217; entry under peronal settings. Simply generate a new one via the &#8216;generate auth key&#8217; button and give it quick description, otherwise using defaults for&nbsp;now.</li>
</ul>
</li>
</ul>
<h2 id="setting-up-the-vyos-connection">Setting up the VyOS&nbsp;connection</h2>
<p>Before jumping into config mode we need to pull in the image so we don&#8217;t get any errors when setting things up, to do this just issue the following command and it&#8217;ll be pulled from the standard contianer&nbsp;repositories:</p>
<p><code>add container image tailscale/tailscale:latest</code></p>
<p>Additionally we need to make a folder to store configs and state information from tailscale, this can be whatever you want but for simplicity tailscale and tailscale/state will&nbsp;work:</p>
<p><code>mkdir -p /config/telnet/state</code></p>
<p>With that all the pre-config steps are done and we can dive into the config&nbsp;mode.</p>
<p>For starters create the new container entry and enter into editing mode for it&nbsp;with:</p>
<div class="highlight"><pre><span></span><code>edit<span class="w"> </span>container

<span class="nb">set</span><span class="w"> </span>name<span class="w"> </span>tailscale<span class="w"> </span>image<span class="w"> </span>ghcr.io/tailscale/tailscale:latest

edit<span class="w"> </span>name<span class="w"> </span>tailscale

<span class="c1">## your editor should look like: `[edit container name tailscale]`</span>
</code></pre></div>

<p>From here we need to add a few container capabilities / allowances and the network&nbsp;configuration:</p>
<div class="highlight"><pre><span></span><code><span class="c1">## replace container network name with your containers network and replace the ip with your selected ip</span>
<span class="nb">set</span><span class="w"> </span>network<span class="w"> </span>&lt;container<span class="w"> </span>network<span class="w"> </span>name&gt;<span class="w"> </span>address<span class="w"> </span>&lt;container<span class="w"> </span>ip&gt;

<span class="c1">## Allow the container to create network interfaces, routing tables, and firewall rules</span>
<span class="nb">set</span><span class="w"> </span>capability<span class="w"> </span>net-admin

<span class="c1">## Allow the container to create raw network sockets, this may not be strictly necessary but I believe the wireguard interface requires it</span>
<span class="nb">set</span><span class="w"> </span>capability<span class="w"> </span>net-raw

<span class="c1">## We need to import the tunnel device into the container for it to create new vpn interfaces</span>
<span class="nb">set</span><span class="w"> </span>device<span class="w"> </span>tunnel<span class="w"> </span><span class="nb">source</span><span class="w"> </span>/dev/net/tun
<span class="nb">set</span><span class="w"> </span>device<span class="w"> </span>tunnel<span class="w"> </span>destination<span class="w"> </span>/dev/net/tun

<span class="c1">## Configure memory limits - optional but a good belt and suspenders</span>
<span class="nb">set</span><span class="w"> </span>shared-memory<span class="w"> </span><span class="m">128</span>
<span class="nb">set</span><span class="w"> </span>memory<span class="w"> </span><span class="m">512</span>

<span class="c1">## Allow the container to advertise routes to your local ip ranges of choice:</span>
<span class="nb">set</span><span class="w"> </span>environment<span class="w"> </span>TS_ROUTES<span class="w"> </span>value<span class="w"> </span><span class="s1">&#39;&lt;cidr notation networks comma seperated&gt;&#39;</span>

<span class="c1">## Set advertised hostname</span>
<span class="nb">set</span><span class="w"> </span>environment<span class="w"> </span>TS_HOSTNAME<span class="w"> </span>value<span class="w"> </span>vyos_ts
<span class="nb">set</span><span class="w"> </span>hostname<span class="w"> </span>vyos_ts
</code></pre></div>

<p>Configure the volumes and related environment&nbsp;variables:</p>
<div class="highlight"><pre><span></span><code><span class="c1">## set the state directory</span>
<span class="nb">set</span><span class="w"> </span>environment<span class="w"> </span>TS_STATE_DIR<span class="w"> </span>value<span class="w"> </span>/var/lib/tailscale

<span class="c1">## configure the volume to connect the container folder to the config directory</span>
<span class="nb">set</span><span class="w"> </span>volume<span class="w"> </span>state<span class="w"> </span>destination<span class="w"> </span>/var/lib/tailscale
<span class="nb">set</span><span class="w"> </span>volume<span class="w"> </span>state<span class="w"> </span><span class="nb">source</span><span class="w"> </span>/config/tailscale/state
</code></pre></div>

<p>And finally, configure the individual container settings for tailscale, this is done purely with environment&nbsp;variables:</p>
<div class="highlight"><pre><span></span><code><span class="c1">## Set Auth Key for the container, replace auth key with generated key from tailscale interface</span>
<span class="nb">set</span><span class="w"> </span>environment<span class="w"> </span>TS_AUTHKEY<span class="w"> </span>value<span class="w"> </span>tskey-auth-&lt;auth<span class="w"> </span>key&gt;

<span class="c1">## Enable or disable metrics</span>
<span class="nb">set</span><span class="w"> </span>environment<span class="w"> </span>TS_ENABLE_METRICS<span class="w"> </span>value<span class="w"> </span><span class="nb">true</span>

<span class="c1">## enable health checks</span>
<span class="nb">set</span><span class="w"> </span>environment<span class="w"> </span>TS_ENABLE_HEALTH_CHECK<span class="w"> </span>value<span class="w"> </span><span class="nb">true</span>

<span class="c1">## set the container extra arguements</span>
<span class="c1">## this wilil make the target and exit node, disable snat (making the tailscale network routable and vis-versa)</span>
<span class="nb">set</span><span class="w"> </span>environment<span class="w"> </span>TS_EXTRA_ARGS<span class="w"> </span>value<span class="w"> </span><span class="s1">&#39;--advertise-exit-node --accept-routes --snat-subnet-routes=false --stateful-filtering=false&#39;</span>
</code></pre></div>

<p>Once done if you issue&nbsp;a <code>show</code> command it should look something like&nbsp;this:</p>
<div class="highlight"><pre><span></span><code><span class="w"> </span><span class="err">capabili</span><span class="kc">t</span><span class="err">y</span><span class="w"> </span><span class="kc">net</span><span class="mi">-</span><span class="err">admi</span><span class="kc">n</span>
<span class="w"> </span><span class="err">capabili</span><span class="kc">t</span><span class="err">y</span><span class="w"> </span><span class="kc">net</span><span class="mi">-</span><span class="err">raw</span>
<span class="w"> </span><span class="err">device</span><span class="w"> </span><span class="kc">tunnel</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="err">des</span><span class="kc">t</span><span class="err">i</span><span class="kc">nat</span><span class="err">io</span><span class="kc">n</span><span class="w"> </span><span class="err">/dev/</span><span class="kc">net</span><span class="err">/</span><span class="kc">tun</span>
<span class="w">     </span><span class="err">source</span><span class="w"> </span><span class="err">/dev/</span><span class="kc">net</span><span class="err">/</span><span class="kc">tun</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="err">e</span><span class="kc">n</span><span class="err">viro</span><span class="kc">n</span><span class="err">me</span><span class="kc">nt</span><span class="w"> </span><span class="err">TS_AUTHKEY</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="err">value</span><span class="w"> </span><span class="kc">ts</span><span class="err">key</span><span class="mi">-</span><span class="err">au</span><span class="kc">t</span><span class="err">h</span><span class="mi">-</span><span class="err">&lt;your</span><span class="w"> </span><span class="err">au</span><span class="kc">t</span><span class="err">hkey</span><span class="w"> </span><span class="err">here&gt;</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="err">e</span><span class="kc">n</span><span class="err">viro</span><span class="kc">n</span><span class="err">me</span><span class="kc">nt</span><span class="w"> </span><span class="err">TS_ENABLE_HEALTH_CHECK</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="err">value</span><span class="w"> </span><span class="kc">true</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="err">e</span><span class="kc">n</span><span class="err">viro</span><span class="kc">n</span><span class="err">me</span><span class="kc">nt</span><span class="w"> </span><span class="err">TS_EXTRA_ARGS</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="err">value</span><span class="w"> </span><span class="s2">&quot;--advertise-exit-node --accept-routes --snat-subnet-routes=false --stateful-filtering=false&quot;</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="err">e</span><span class="kc">n</span><span class="err">viro</span><span class="kc">n</span><span class="err">me</span><span class="kc">nt</span><span class="w"> </span><span class="err">TS_HOSTNAME</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="err">value</span><span class="w"> </span><span class="err">vyos_</span><span class="kc">ts</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="err">e</span><span class="kc">n</span><span class="err">viro</span><span class="kc">n</span><span class="err">me</span><span class="kc">nt</span><span class="w"> </span><span class="err">TS_ROUTES</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="err">value</span><span class="w"> </span><span class="err">x.x.x.</span><span class="mi">0</span><span class="err">/</span><span class="mi">24</span><span class="p">,</span><span class="err">x.x.y.</span><span class="mi">0</span><span class="err">/</span><span class="mi">24</span><span class="p">,</span><span class="err">x.x.z.</span><span class="mi">0</span><span class="err">/</span><span class="mi">24</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="err">e</span><span class="kc">n</span><span class="err">viro</span><span class="kc">n</span><span class="err">me</span><span class="kc">nt</span><span class="w"> </span><span class="err">TS_USERSPACE</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="err">value</span><span class="w"> </span><span class="kc">false</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="err">hos</span><span class="kc">t</span><span class="mi">-</span><span class="kc">na</span><span class="err">me</span><span class="w"> </span><span class="err">vyos_</span><span class="kc">ts</span>
<span class="w"> </span><span class="err">image</span><span class="w"> </span><span class="kc">ta</span><span class="err">ilscale/</span><span class="kc">ta</span><span class="err">ilscale</span><span class="p">:</span><span class="err">la</span><span class="kc">test</span>
<span class="w"> </span><span class="err">memory</span><span class="w"> </span><span class="mi">512</span>
<span class="w"> </span><span class="kc">net</span><span class="err">work</span><span class="w"> </span><span class="err">CONTAINERNET</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="err">address</span><span class="w"> </span><span class="err">x.x.x.x</span>
<span class="w"> </span><span class="p">}</span>
<span class="w"> </span><span class="err">res</span><span class="kc">tart</span><span class="w"> </span><span class="err">always</span>
<span class="w"> </span><span class="err">shared</span><span class="mi">-</span><span class="err">memory</span><span class="w"> </span><span class="mi">128</span>
<span class="w"> </span><span class="err">volume</span><span class="w"> </span><span class="err">s</span><span class="kc">tate</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="err">des</span><span class="kc">t</span><span class="err">i</span><span class="kc">nat</span><span class="err">io</span><span class="kc">n</span><span class="w"> </span><span class="err">/var/lib/</span><span class="kc">ta</span><span class="err">ilscale</span>
<span class="w">     </span><span class="err">source</span><span class="w"> </span><span class="err">/co</span><span class="kc">nf</span><span class="err">ig/</span><span class="kc">ta</span><span class="err">ilscale/s</span><span class="kc">tate</span>
<span class="w"> </span><span class="p">}</span>
</code></pre></div>

<h2 id="configure-routing-so-devices-are-individually">Configure Routing so devices are&nbsp;individually</h2>
<p>As this setup is not using a nat / masquerade setup we need to add a routing rule to allow being able to communication out to the external tailscale client devices. For this we need to go back to the top level and set a static route to reach those&nbsp;devices.</p>
<div class="highlight"><pre><span></span><code><span class="c1">### 100.64.0.0/10 is the ip range for tailscale devices; there are some gotchas for this</span>
<span class="c1">## you might need to move to ipv6 if you run into issue with this</span>
<span class="nb">set</span><span class="w"> </span>protocols<span class="w"> </span>static<span class="w"> </span>route<span class="w"> </span><span class="m">100</span>.64.0.0/10<span class="w"> </span>next-hop<span class="w"> </span>&lt;container<span class="w"> </span>ip&gt;
</code></pre></div>

<h2 id="firewall-considerations">Firewall&nbsp;Considerations</h2>
<p>Locally I have my container network configured to allow access to all my internal networks so I didn&#8217;t have to do anything exotic. However if your container network is more restricted, or you want an additional layer of restrictions you could always add a zone rule from the container space to the destination spaces you want reachable vs. unreachable. Handling this is out of scope of this article as it&#8217;s more a fundamental feature of vyos than a consideration of the tailscale&nbsp;setup.</p>
<h1 id="adding-a-client-device">Adding a client&nbsp;device</h1>
<p>This will be the same on all desktop clients, and roughly similar for mobile devices. First you need to install the client for the relevant os, this is covered thoroughly in the official documentation <a href="https://tailscale.com/kb/1347/installation">here</a>. Skip logging in as it&#8217;s not necessary for&nbsp;this.</p>
<p>After that you&#8217;ll need to make a key on the tailscale site itself, this can be done from the &#8216;settings-&gt;keys&#8217; page of tailscale once logged in. Or directly <a href="https://login.tailscale.com/admin/settings/keys">from</a>. Select &#8216;Generate auth key&#8217;, give it a description, and optionally add a tag for access control (detailed&nbsp;below).</p>
<p><img alt="Tailscale Key Generation Pane" src="https://blog.shadowgears.com/drafts/tailscale-key-generation.png"></p>
<p>Once you&#8217;ve got these parts done the last step is invoking the <a href="https://tailscale.com/kb/1080/cli">tailscale cli</a> from your commandline of choice. If adding somebody else to your tailscale network you&#8217;ll need to send this auth key to them, I recommend using a secure sharing solution for that and not configuring automatic approval or key&nbsp;reuse.</p>
<p>A quick login command will get the individual device&nbsp;setup:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>tailscale<span class="w"> </span>login<span class="w"> </span>--auth-key<span class="o">=</span>&lt;auth<span class="w"> </span>key&gt;
</code></pre></div>

<p>At this point the client is joined and everything else needs to be handled from the tailscale management page. The key will need to be approved from the <a href="https://login.tailscale.com/admin/machines">machine administration</a> page for&nbsp;instance.</p>
<h1 id="controlling-access">Controlling&nbsp;Access</h1>
<p>This is done fully via the <a href="https://login.tailscale.com/admin/acls/visual/general-access-rules">Access controls</a>&nbsp;page.</p>
<p>First you&#8217;ll need to make <a href="https://login.tailscale.com/admin/acls/visual/tags">tags</a> for the types of devices you want to classify, an easy starting point is simply &#8216;friends&#8217; and &#8216;personal devices&#8217;. Once that&#8217;s done you can start configuring access to things. These can then be added to the machines on the main &#8216;Machines&#8217; page by clicking the ellipses next to a machine&nbsp;(the <code>...</code> to the right) and&nbsp;selecting <code>Edit ACL tags</code>.</p>
<p>After that you&#8217;ll need to create an ipset for any ips you want your these new devies to be able to reach. Add any ips you want to be able to reach remotely to an ipset. Simply naming&nbsp;it <code>remote-access</code> is straight forward enough for purposes&nbsp;here.</p>
<p>Once created you can start assigning attributes and behaviors to things in the access rules page. The default rule allows all traffic to all devices and should be removed if you that&#8217;s not your goal. Then add a new rule with a source&nbsp;of <code>tag:friends</code>, and a destination&nbsp;of <code>ipset:remote-access</code> and save the rule.  This will prevent machines from the &#8216;friends&#8217; list from accessing anything you don&#8217;t include in the list. For ease of use, adding a rule that allows all access for devices listed&nbsp;as <code>tag:personal-devices</code> and assigning the tag to your vyos install ensures it can communicate with everything on the&nbsp;network.</p>
<p>The json representations of these two configs would&nbsp;be:</p>
<div class="highlight"><pre><span></span><code><span class="c1">// access allows for friends coming in from tailscale</span>
<span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;src&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;tag:friends&quot;</span><span class="p">],</span>

<span class="w">    </span><span class="nt">&quot;dst&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s2">&quot;ipset:remote-access&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s2">&quot;tag:personal-devices&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="p">],</span>

<span class="w">    </span><span class="nt">&quot;ip&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">],</span>
<span class="p">}</span>

<span class="c1">//and</span>

<span class="c1">// personal devices are allowed everywhere</span>
<span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;src&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;tag:personal-devices&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;dst&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;ip&quot;</span><span class="p">:</span><span class="w">  </span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">],</span>
<span class="p">}</span>
</code></pre></div>

<p>And at that point you are setup, things should &#8216;just work&#8217; and if they don&#8217;t then you&#8217;ll have to dig into the specific rules and allowances you&#8217;ve&nbsp;configured. </p>
<h1 id="alternatives-and-digressions">Alternatives and&nbsp;Digressions</h1>
<p>Generally speaking while the above is a bit complicated to initially groc it works very very well. It does mean porting some responsibility out to a third party however so if that&#8217;s a concern, falling back to wireguard or headscale are definately&nbsp;options.</p>
<h2 id="just-join-everything-to-tailscale">Just Join Everything to&nbsp;Tailscale</h2>
<p>This is doable, and if the device limit isn&#8217;t a concern you can absolutely do this. For my specific usecase I wanted tailscale to be a &#8216;portal&#8217; to my home network, not a nat bypass for my local security controls. So instead of joining everything to a network that vyos can&#8217;t distiguish against, I opted for a solution that allows anything on my local network to potential talk to a tailscale client if need be. This also allows it to work transparently with docker containers as they do not need to be explicitly told to talk to the tailscale network, they&#8217;re just responding to a request in&nbsp;the <code>100.64.0.0/10</code> ip&nbsp;range.</p>
<h2 id="use-headscale-instead">Use Headscale&nbsp;Instead</h2>
<p>This would eliminate the limitations on device counts and the limitations on users making it easier for people to join, they can simply authenticate rather than needing you to send a key to them. However you would then need to house headscale somewhere, either in a virtual server out on the internet or internally with port forwarding and an fqdn. That doesn&#8217;t really eliminate any work in this case compared to just using tailscale if it&#8217;s restrictions aren&#8217;t a problem for&nbsp;you. </p>
<h2 id="just-suck-it-up-and-use-wireguard">Just Suck it up and use&nbsp;Wireguard</h2>
<p>No.</p>
<p>As noted at the top, I did actually try this at first, but trying to get people that are potentially less technical or knowledgable of the networking configs required to make this work took that off the table. Being able to give somebody and auth key then handle all the routing config and acls yourself without having to remote into their machine or screen share is a huge improvement in time spent. I still use wireguard for my personal devices but for allowing my parents to stream jellyfin from my nas directly to their appletv? This is trivial in comparison setup&nbsp;wise.</p>
        </div>

        <!-- Neighbors -->

        <!-- Google Adsense -->

    <!-- Releated posts -->

    <!-- Comments -->
                </div>
        </main>

    </div>

    <!-- Footer -->
    <footer class="flex-shrink-0 bg-dark text-light small py-1">
        <div class="container text-center">
            &copy;  <a href="https://blog.shadowgears.com">Putting the Pieces Together</a> by <a href="https://blog.shadowgears.com/pages/about.html">Garrett</a>. Powered by <a href="http://getpelican.com">Pelican</a>, <a href="http://python.org">Python</a>, <a href="https://getbootstrap.com">Bootstrap 4</a><br>
            <!-- Do not remove below license sentence -->
            License: <a href="https://spdx.org/licenses/CC-BY-4.0.html">CC-BY-4.0</a>, based on <a href="https://github.com/vuquangtrong/simplify-theme">Simplify Bootstrap Theme</a>
        </div>
    </footer>

    <!-- Scripts -->
    <!--
    <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.4.1.min.js"></script>
    -->
    <script type="text/javascript" src="https://blog.shadowgears.com/theme/jquery/jquery-3.4.1.min.js"></script>
    <!--
    <script src="https://ajax.aspnetcdn.com/ajax/bootstrap/4.3.1/bootstrap.min.js"></script>
    -->
    <script type="text/javascript" src="https://blog.shadowgears.com/theme/bootstrap/bootstrap.min.js"></script>
    <!--
    <script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script>
    -->
    <script type="text/javascript" src="https://blog.shadowgears.com/theme/style.js"></script>

    <!-- Sharing -->

    <!-- JSON LD -->
<script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "name": "Using VyOS and Tailscale to build a Friends and Family Sharing Network",
    "headline": "Using VyOS and Tailscale to build a Friends and Family Sharing Network",
    "datePublished": "2025-09-27 00:00:00-04:00",
    "dateModified": "",
    "author": {
        "@type": "Person",
        "name": "Garrett",
        "url": "https://blog.shadowgears.com/author/garrett.html"
    },
    "image": "https://blog.shadowgears.com/favicon.ico",
    "url": "https://blog.shadowgears.com/drafts/vyos-and-tailscale-friendnets.html",
    "description": "Defining the problem space I’ve been working on digitally ‘battening down the hatches’ a bit at my house and trying to solve some access challenges that have been bothering me. Specifically being able to share access to applications I’ve got running in my home to friends that want …"
}
</script>
    <!-- Disqus count -->
</body>

</html>