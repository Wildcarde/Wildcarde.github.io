
<!DOCTYPE html>
<html lang="en">

<!-- Head -->
<head>

        <!-- Required metadata tags -->
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="HandheldFriendly" content="True" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

        <!-- Default metadata -->
    <meta name="author" content="Garrett McGrath" />
    <meta name="description" content="A rundown of how this blog is written, stored, and published" />
    <meta name="keywords" content="deployment, blog">
<meta property="og:site_name" content="Putting the Pieces Together" />
<meta property="og:title" content="Building the Blog" />
<meta property="og:description" content="A rundown of how this blog is written, stored, and published" />
<meta property="og:locale" content="en_US" />
<meta property="og:url" content="https://blog.shadowgears.com/building-the-blog.html" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-04-11 02:10:00-04:00" />
<meta property="article:modified_time" content="" />
<meta property="article:author" content="https://blog.shadowgears.com/author/garrett-mcgrath.html">
<meta property="article:section" content="HowTo" />
	<meta property="article:tag" content="deployment" />
	<meta property="article:tag" content="blog" />
	<meta property="og:image" content="https://blog.shadowgears.com/">

        <!-- Site Claim -->


        <!-- Title -->
        <title>
    Building the Blog &ndash; Putting the Pieces Together
        </title>
        
        <!-- Icon -->
        <link rel="shortcut icon" href="https://blog.shadowgears.com/favicon.ico" type="image/x-icon">
        <link rel="icon" href="https://blog.shadowgears.com/favicon.ico" type="image/x-icon">

        <!-- Search engine -->
            <meta name="robots" content="" />

        <!-- Feeds -->
            <link href="https://blog.shadowgears.com/feeds/atom.all.xml" type="application/atom+xml" rel="alternate" title="Putting the Pieces Together Full Atom Feed" />

            <link href="https://blog.shadowgears.com/feeds/rss.all.xml" type="application/rss+xml" rel="alternate" title="Putting the Pieces Together Full RSS Feed" />







        <!-- Styles -->
        <!--
        <link rel="stylesheet" href="https://ajax.aspnetcdn.com/ajax/bootstrap/4.3.1/css/bootstrap.min.css">
        -->
        <link rel="stylesheet" href="https://blog.shadowgears.com/theme/bootstrap/bootstrap.min.css">
        <!--
        <link rel="stylesheet" href="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.css">
        -->
            <link rel="stylesheet" href="https://blog.shadowgears.com/theme/extra/bootstrap-toc.min.css">
        <link rel="stylesheet" href="https://blog.shadowgears.com/theme/pygment/friendly.min.css">
        <!--
        <link rel="stylesheet" href="https://blog.shadowgears.com/theme/extra/admonition.min.css">
        -->
        <link rel="stylesheet" href="https://blog.shadowgears.com/theme/style.css">

        <!-- Google Analytics -->

        <!-- Google Global Site Tag -->

        <!-- Google Tag Manager -->

        <!-- Google Adsense -->

        <!-- Heap Analytic -->

        <!-- Piwik Tracking -->

        <!-- Matomo Tracking -->

</head>

<!-- Body -->
<body class="d-flex flex-column" data-spy="scroll" data-target="#toc" data-offset="0" style="position: relative;">
    <!-- Top anchor -->
    <a href="#" id="backToTop" style="display: none; z-index: 1;" title="Back to top"><span></span></a>

    <!-- Google tag manager -->

    <!-- Navigation -->
    <nav class="flex-shrink-0 navbar navbar-expand-md navbar-expand-lg navbar-dark bg-dark text-light shadow-sm">
        <!-- Logo -->
        <a class="navbar-brand" href="https://blog.shadowgears.com"></a>

        <!-- Collapse button -->
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMenu" aria-controls="navbarMenu" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon small"></span>
        </button>

        <!-- Collapsible content -->
        <div class="collapse navbar-collapse" id="navbarMenu">

            <!-- i18n subsites -->

            <!-- Page links -->
            <ul class="navbar-nav mr-auto text-center">
                <li class="nav-item ">                           
                    <a class="nav-link" href="https://blog.shadowgears.com">
                        <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24">
                            <path d="M21 13v10h-6v-6h-6v6h-6v-10h-3l12-12 12 12h-3zm-1-5.907v-5.093h-3v2.093l3 3z" fill="currentColor"></path>
                        </svg>
                        Home <span class="sr-only">(current)</span>
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="https://blog.shadowgears.com/categories.html">
                        <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24">
                            <path d="M16 6h-8v-6h8v6zm-8 12h-8v6h8v-6zm16 0h-8v6h8v-6zm-11-7v-3h-2v3h-8v5h2v-3h14v3h2v-5h-8z" fill="currentColor"></path>
                        </svg>
                        Categories
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="https://blog.shadowgears.com/tags.html">
                        <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24">
                            <path d="M10.605 0h-10.605v10.609l13.391 13.391 10.609-10.604-13.395-13.396zm-4.191 6.414c-.781.781-2.046.781-2.829.001-.781-.783-.781-2.048 0-2.829.782-.782 2.048-.781 2.829-.001.782.782.781 2.047 0 2.829z" fill="currentColor"></path>
                        </svg>
                        Tags
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="https://blog.shadowgears.com/archives.html">
                        <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24">
                            <path d="M1.8 9l-.8-4h22l-.8 4h-2.029l.39-2h-17.122l.414 2h-2.053zm18.575-6l.604-2h-17.979l.688 2h16.687zm3.625 8l-2 13h-20l-2-13h24zm-8 4c0-.552-.447-1-1-1h-6c-.553 0-1 .448-1 1s.447 1 1 1h6c.553 0 1-.448 1-1z" fill="currentColor"></path>
                        </svg>
                        Archives
                    </a>
                </li>
                <li class="nav-item ">
                    <a class="nav-link" href="https://blog.shadowgears.com/pages/about.html">
                        <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24">
                            <path d="M20.822 18.096c-3.439-.794-6.64-1.49-5.09-4.418 4.72-8.912 1.251-13.678-3.732-13.678-5.082 0-8.464 4.949-3.732 13.678 1.597 2.945-1.725 3.641-5.09 4.418-3.073.71-3.188 2.236-3.178 4.904l.004 1h23.99l.004-.969c.012-2.688-.092-4.222-3.176-4.935z" fill="currentColor"></path>
                        </svg>
                        About
                    </a>
                </li>
            </ul>

            <!-- Search form 
            <form class="form-inline text-center" action="https://blog.shadowgears.com/search.html">
                <input class="form-control w-100 bg-dark text-light text-center border-0 p-2" type="text" name="q" pattern=".{3,}" title="At least 3 characters" required="" placeholder="Type here to search" aria-label="Search">
            </form>-->

            <!-- Social links -->
            <ul class="navbar-nav text-center">
                <li class="nav-item">
                    <a class="nav-link" href="https://github.com/wildcarde">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                            <title>Github</title>
                            <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z" fill="currentColor"></path>
                        </svg>
                    </a>
                </li>
            </ul>
        </div>
    </nav>

    <!-- Full page -->
    <div class="flex-shrink-0 flex-grow-1">

        <!-- Header -->
        <header class="bg-dark text-light shadow-sm pt-3 pb-2">
	<div class="container">
		<h3 id="building-the-blog">Building the&nbsp;Blog</h3>
		<p style="font-size:larger;"><p>A rundown of how this blog is written, stored, and&nbsp;published</p></p>
        <div class="row mx-auto mt-3">
            <div class="col-xs-12 col-sm-12 col-md-6 text-left" style="padding: 0">
                <a href="https://blog.shadowgears.com/author/garrett-mcgrath.html" class="card-link">Garrett McGrath</a>
                <span class="card-link text-success">
                    <span class="post-date" title="Post date">Sun 11 April 2021</span>
                    <span class="text-info modified-date" title="Updated date">
                            Sun 11 April 2021
                    </span>
                </span>
            </div>
            <div class="col-xs-12 col-sm-12 col-md-6 text-right" style="padding: 0">
                <a class="badge badge-success" href="https://blog.shadowgears.com/category/howto.html">howto</a>
                    <a class="badge badge-info" href="https://blog.shadowgears.com/tag/deployment.html">deployment</a>
                    <a class="badge badge-info" href="https://blog.shadowgears.com/tag/blog.html">blog</a>
            </div>
        </div>
	</div>
        </header>

        <!-- Main -->
        <main class="py-3">
                <div class="container">
                    <!-- Sharing -->

                    <!-- Content -->
    <!-- 2 columns layout -->
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-10">

                <!-- Sharing -->

                <!-- Article -->
                <p>It&#8217;s been a while since I&#8217;ve spent any serious time looking at blogging, static site generation, and the github pages system so it was no surprise that my knowledge was more than a little out of date.  What was surprising however was how much information online seems to be equally out of date at this point a state that was a little disappointing but not overtly surprising.  It&#8217;s not like github shouts from the rooftop when they change things quietly in the background, especially when those old approaches still&nbsp;work.  </p>
<p>So this post will serve somewhat as modern documentation for how github user pages can be setup and automated to use <a href="https://blog.getpelican.com/">Pelican</a> to generate a blog (like this&nbsp;one).</p>
<h2 id="how-things-used-to-work">How things used to&nbsp;work</h2>
<p>Originally what you would do is create a public repository named <code>&lt;githubuser&gt;.github.io</code>.  From here the <code>main</code> or <code>master</code> branch in the repository would be your raw content, so in pelican a folder full of markdown files.  From there you&#8217;d generate an output folder, that typically you would not capture in git, and merge that into a separate branch named <code>gh-pages</code>.  This felt like creating some sort of weird hell alternate file stream based approach and was generally kinda difficult to wrap your head around.  The alternative was brute forcing it by simply checking out two different copies of the same repo in separate folders, then just copy/pasting from one to the other and pushing.  This works but at that point, why have them be the same repo?  I suspect this is something github realized somewhere along the way because that&#8217;s how you do it&nbsp;now!</p>
<h2 id="structure">Structure</h2>
<p>Github has simplified things a bit, now you can just put your websites static folder in the main branch (<code>main</code> or <code>master</code> depending on repo settings and age).  This allows us some flexibility, the core of this blog is published from a private repository allowing me to not exposed my pelican configs, comment cruft, in dev theme files, and other details around how pelican sites are published in the public repository that serves out what you are&nbsp;reading.</p>
<p>To get started I made a conda environment to use for local test builds, it&#8217;s overkill but miniconda envs are my default approach, to this we need to add the following packages (this is the contents of my <code>requirements.txt</code> file, but using the latest versions should work; you might not even need all of&nbsp;this):</p>
<div class="highlight"><pre><span></span><code><span class="na">blinker</span><span class="o">=</span><span class="s">=1.4</span>
<span class="na">docutils</span><span class="o">=</span><span class="s">=0.16</span>
<span class="na">feedgenerator</span><span class="o">=</span><span class="s">=1.9.1</span>
<span class="na">Jinja2</span><span class="o">=</span><span class="s">=2.11.3</span>
<span class="na">Markdown</span><span class="o">=</span><span class="s">=3.2.2</span>
<span class="na">MarkupSafe</span><span class="o">=</span><span class="s">=1.1.1</span>
<span class="na">pelican</span><span class="o">=</span><span class="s">=4.5.4</span>
<span class="na">pelican-render-math</span><span class="o">=</span><span class="s">=1.0.3</span>
<span class="na">Pygments</span><span class="o">=</span><span class="s">=2.6.1</span>
<span class="na">python-dateutil</span><span class="o">=</span><span class="s">=2.8.1</span>
</code></pre></div>

<p>After that environment is created and activated the private repo needs to be cloned into a local folder, and cd&#8217;d into so it&#8217;s your working directory. At this point the basic pelican environment can be created with the <code>pelican-quickstart</code> command, this will create the default folder structure and config files needed to get everything running. Before adding and committing these changes add a quick <code>.gitignore</code> file with the following&nbsp;ignores:</p>
<div class="highlight"><pre><span></span><code><span class="nf">__pycache__</span>
<span class="na">.vscode</span><span class="err">/</span><span class="p">*</span>

<span class="nf">output</span><span class="err">/</span><span class="p">*</span>
</code></pre></div>

<p>Once the above is added to git it can be committed and pushed up to the private repository.  This sets up the base you need to build on going&nbsp;forward.</p>
<h3 id="custom-url">Custom <span class="caps">URL</span></h3>
<p>If using a custom url (like say <code>blog.shadowgears.com</code>) you&#8217;ll need to do a few&nbsp;things:</p>
<p>1) make a folder inside your <code>content</code> folder named <code>extra</code> and add a file named <code>CNAME</code> with the custom domain name in it, that will handle the <span class="caps">CNAME</span> id file required by <a href="https://docs.github.com/en/github/working-with-github-pages/configuring-a-custom-domain-for-your-github-pages-site">github pages</a>.<br>
2) Add the following to your <code>pelicanconf.py</code> file:</p>
<div class="highlight"><pre><span></span><code><span class="n">STATIC_PATHS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;extra&#39;</span><span class="p">,</span><span class="s1">&#39;extra/CNAME&#39;</span><span class="p">]</span>  <span class="c1">#this flags these folders as &#39;static&#39; they will not be run through any parsers</span>
<span class="n">EXTRA_PATH_METADATA</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;extra/CNAME&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="s1">&#39;CNAME&#39;</span><span class="p">}}</span> <span class="c1">#this takes the file and puts it at the root of the published directory and names it CNAME per the requirements in the github pages docs</span>
</code></pre></div>

<p>3) Add the following to your <code>publishconf.py</code>:</p>
<div class="highlight"><pre><span></span><code><span class="n">SITEURL</span> <span class="o">=</span> <span class="s1">&#39;https://&lt;your site url here&gt;&#39;</span>
</code></pre></div>

<p>Adding the above will ensure that the file <code>CNAME</code> is placed in the root of your output folder every time the site is generated so even if it&#8217;s removed by accident it&#8217;ll be re-instated on the next publish.  Additionally setting the siteurl will make sure all internal links on the site point to the correct location when the site is&nbsp;published.</p>
<h2 id="auto-publishing-posts">Auto Publishing&nbsp;Posts</h2>
<p>At this point you can publish the content, using the <code>make publish</code> command will push a full processed copy of the content folder to <code>output</code>, and for some that&#8217;s probably anywhere between good and fine. But that&#8217;s not something I want to have to remember every time I write something new, so the next step is to solve automatic publishing!  We&#8217;ll be pushing from our private repository to the public one so we are going to need a <a href="https://github.com/settings/tokens">personal access token</a> with the <code>repo-&gt;public repo</code> privileges, I&#8217;ve tested no additional privileges are required.  Make sure you note this key value down somewhere you can copy / paste&nbsp;it.</p>
<p>The next step is going to be adding this as a secret attached to your private repository, this is done in the specific private repos <code>settings-&gt;secrets</code>, simply add a new secret named <code>APITOKENPUBLISH</code> and paste the contents of the generated token above in as the value. This will be used by the github action we&#8217;ll be setting up&nbsp;next.</p>
<p>Now that we&#8217;ve got the basics needed to make this work all that&#8217;s required is adding the automatic workflow to the private repository.  This will be broken into a few&nbsp;steps:</p>
<p>1) Checkout a copy of the repository.<br>
2) Run <code>make publish</code> on the contents of the repository.<br>
3) Clone the public repository into a separate location, copy the output of <code>make publish</code> into it, and push it back&nbsp;out.  </p>
<p>To get this started we&#8217;ll need a new set of folders at the root of the repository named <code>.github/workflows</code>, inside here is where we&#8217;ll place the rest of the magic.  Once that folder is in-place we are going to need a yaml file inside it, this can be named whatever but I&#8217;m going for <code>pelican-publish.yml</code>.  This is going to be a <a href="https://docs.github.com/en/actions/quickstart">github actions</a> file and is the reason we made that secret entry further up the post.  A full copy of the action file is included at the end of this post, the following sections break down the sub&nbsp;parts.</p>
<h3 id="setup-the-environment">Setup the&nbsp;Environment</h3>
<p>This initial segment sets up some rules and the python environment.  We&#8217;ll be naming the action <code>Pelican-Publisher</code>, restricting it to only run on pushes to our source repository, and instructing it to run on ubuntu.  This last part we could probably make something lighter weight just so it runs a little faster (this process is slower than I&#8217;d like) but for simplicity and compatibility with most published documentation and actions I stuck with ubuntu here.  The last bits of this step check out the private repository and creates a python&nbsp;environment </p>
<div class="highlight"><pre><span></span><code><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pelican-Publisher</span>

<span class="c1"># Run this workflow ever time a new commit is pushed ot the repo</span>
<span class="nt">on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">push</span>

<span class="nt">jobs</span><span class="p">:</span>
<span class="w">  </span><span class="nt">publish</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Publish</span><span class="w"> </span>

<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>

<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="c1">## pull the committed code into an environment.</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Checkout Code</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v2</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Set up Python 3.9</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/setup-python@v2</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">python-version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3.9</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install Dependencies</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">python -m pip install --upgrade pip</span>
<span class="w">          </span><span class="no">pip install -r requirements.txt</span>
</code></pre></div>

<h3 id="build-the-website">Build the&nbsp;Website</h3>
<p>This sounds like it should be long or complicated, it&#8217;s neither.  If test <code>make publish</code> commands worked on the local system the adding this to the above will build the website&nbsp;fresh:</p>
<div class="highlight"><pre><span></span><code><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Build Site</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">make publish</span>
</code></pre></div>

<p>If this doesn&#8217;t work, there&#8217;s probably an issue with your local <code>make publish</code> or with your requirements file, verify those are correct then revisit&nbsp;this.</p>
<h3 id="publish-the-website">Publish the&nbsp;Website</h3>
<p>The actual complicated part of this is here, we&#8217;ll be making use of user <a href="https://github.com/cpina">cpina</a>&#8216;s <a href="https://github.com/cpina/github-action-push-to-another-repository">github-action-push-to-another-repository</a> published action to do the heavy lifting here.  It&#8217;ll require a few quick inputs, mostly involving your github <span class="caps">ID</span> or the afore mentioned <span class="caps">API</span> key&nbsp;secret.</p>
<div class="highlight"><pre><span></span><code><span class="w">      </span><span class="c1"># push generated site to public repo</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pushes to another repository</span>
<span class="w">        </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">push_directory</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cpina/github-action-push-to-another-repository@v1.2</span>
<span class="w">        </span><span class="nt">env</span><span class="p">:</span>
<span class="w">          </span><span class="nt">API_TOKEN_GITHUB</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.APITOKENPUBLISH }}</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">source-directory</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;output&#39;</span>
<span class="w">          </span><span class="nt">destination-github-username</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;&lt;your</span><span class="nv"> </span><span class="s">github</span><span class="nv"> </span><span class="s">id</span><span class="nv"> </span><span class="s">here&gt;&#39;</span>
<span class="w">          </span><span class="nt">destination-repository-name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;&lt;your</span><span class="nv"> </span><span class="s">github</span><span class="nv"> </span><span class="s">id</span><span class="nv"> </span><span class="s">here&gt;.github.io&#39;</span>
<span class="w">          </span><span class="nt">user-email</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;your email address here so the commit is signed correctly&gt;</span>
<span class="w">          </span><span class="nt">commit-message</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Automated Update</span>
<span class="w">          </span><span class="nt">target-branch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">main</span>
</code></pre></div>

<p>This action does a few things. First it checks out the target repository, in this case our public <code>&lt;username&gt;.github.io</code> repository. Then it makes a new folder and copies just the <code>.git</code> subfolder from the checked out repository into there. Over top of this it copies the contents of the folder <code>output</code>, and finally issues a commit and push of this newly minted git&nbsp;repository.</p>
<p>Doing it this way is important in that it ensures you have a completely clean copy of the generated output as your new website version instead of possibly missing an article deletion or restructuring that doesn&#8217;t get tracked&nbsp;properly.</p>
<h3 id="putting-it-all-together">Putting it all&nbsp;together</h3>
<p>This is the full action file ready to be copy/pasted and updated to your own&nbsp;settings.</p>
<div class="highlight"><pre><span></span><code><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pelican-Publisher</span>

<span class="c1"># Run this workflow ever time a new commit is pushed ot the repo</span>
<span class="nt">on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">push</span>

<span class="nt">jobs</span><span class="p">:</span>
<span class="w">  </span><span class="nt">publish</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Publish</span><span class="w"> </span>

<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>

<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="c1">## pull the committed code into an environment.</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Checkout Code</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v2</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Set up Python 3.9</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/setup-python@v2</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">python-version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3.9</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install Dependencies</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">python -m pip install --upgrade pip</span>
<span class="w">          </span><span class="no">pip install -r requirements.txt</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Build Site</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">make publish</span>
<span class="w">      </span><span class="c1"># push generated site to public repo</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pushes to another repository</span>
<span class="w">        </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">push_directory</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cpina/github-action-push-to-another-repository@v1.2</span>
<span class="w">        </span><span class="nt">env</span><span class="p">:</span>
<span class="w">          </span><span class="nt">API_TOKEN_GITHUB</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${{ secrets.APITOKENPUBLISH }}</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">source-directory</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;output&#39;</span>
<span class="w">          </span><span class="nt">destination-github-username</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;&lt;your</span><span class="nv"> </span><span class="s">github</span><span class="nv"> </span><span class="s">id</span><span class="nv"> </span><span class="s">here&gt;&#39;</span>
<span class="w">          </span><span class="nt">destination-repository-name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;&lt;your</span><span class="nv"> </span><span class="s">github</span><span class="nv"> </span><span class="s">id</span><span class="nv"> </span><span class="s">here&gt;.github.io&#39;</span>
<span class="w">          </span><span class="nt">user-email</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;your email address here so the commit is signed correctly&gt;</span>
<span class="w">          </span><span class="nt">commit-message</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Automated Update</span>
<span class="w">          </span><span class="nt">target-branch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">main</span>
</code></pre></div>

<h2 id="adding-content">Adding&nbsp;Content</h2>
<p>In the process of writing this article I&#8217;ve gone from using VSCode to write it, to moving to <span class="caps">ZETTLR</span>, and then switching back to vscode for a few reasons.  Initially when I was developing this article in vscode I&#8217;d attempted to install a spell checker to make sure my writing is at least spelled right if not you know, comprehensible.  Unfortunately the recommended spell checker just seemed to freak out and highlight the entire markdown file as spelled incorrectly.  So I removed that addon and migrated over to editing in a zettlr window, this has some upsides I really liked. The spell checking is sane, rendering markdown &#8216;live&#8217; as you edit it works incredibly well.  Unfortunately the folder handling is rather clunky, zettlr has opinions about how things are organized and they don&#8217;t mesh with how I work as well as I thought.  Additionally the linux version seems to have some serious keyboard shortcut collisions that I didn&#8217;t have the willpower to fix; when you are trying to paste with <code>ctrl+v</code> and it instead keeps warping you to the bottom of the page for some reason, it&#8217;s time to stop fighting a tool not setup to do what you want. So I&#8217;m back to using vscode as my editor, however in the mean time I&#8217;ve found a different spellchecker for vscode that acts more sanely.  The <a href="https://marketplace.visualstudio.com/items?itemName=streetsidesoftware.code-spell-checker">Code Spell Checker</a> by Street Side Software works more or less how I&#8217;d expect. The only nagging point currently is having to hit <code>ctrl+.</code> instead of right clicking on a misspelled word in order to fix it.  All in all, it works and that&#8217;s what&#8217;s important&nbsp;here.</p>
<h2 id="notes">Notes</h2>
<p>Below are notes and references used to work out the details&nbsp;above.</p>
<p>This blog is built and published using the <a href="https://docs.getpelican.com/en/3.6.3/index.html">Pelican static site generator system</a> in a two stage&nbsp;setup.</p>
<p>reference material on the current state of github&nbsp;pages:</p>
<p>actions reference&nbsp;materials:</p>
<ul>
<li>https://github.com/marketplace/actions/push-directory-to-another-repository</li>
<li>https://github.com/cpina/push-to-another-repository-example</li>
<li>https://nolanbconaway.github.io/pelican-deploy-gh-actions/pages/deployment-on-github-pages.html</li>
<li>https://docs.github.com/en/actions/quickstart</li>
</ul>
<p>currently using: github actions based on ubuntu-latest, python setup commands, and the push directory to another repository&nbsp;action.</p>

                <!-- Neighbors -->
                    <br>
                    <b>Read more:</b><br>
<div class="pagination">
    <a class="w-100" href="https://blog.shadowgears.com/glasscanopy-campaign-report-0.html">
Glass Canopy Campaign, Report&nbsp;0
    </a>
</div>
                <!-- Google Adsense -->
            </div>

            <!-- Sidebar -->
            <div class="col-md-2 d-none d-md-block small">
                <div class="sticky-top">
                    <!-- ToC -->
                    <nav id="toc" data-toggle="toc" ></nav>

                    <!-- Share post -->

                    <!-- Google Adsense -->
                </div>
            </div>
        </div>

    <!-- Releated posts -->

    <!-- Comments -->
                </div>
        </main>

    </div>

    <!-- Footer -->
    <footer class="flex-shrink-0 bg-dark text-light small py-1">
        <div class="container text-center">
            &copy;  <a href="https://blog.shadowgears.com">Putting the Pieces Together</a> by <a href="https://blog.shadowgears.com/pages/about.html">Garrett</a>. Powered by <a href="http://getpelican.com">Pelican</a>, <a href="http://python.org">Python</a>, <a href="https://getbootstrap.com">Bootstrap 4</a><br>
            <!-- Do not remove below license sentence -->
            License: <a href="https://spdx.org/licenses/CC-BY-4.0.html">CC-BY-4.0</a>, based on <a href="https://github.com/vuquangtrong/simplify-theme">Simplify Bootstrap Theme</a>
        </div>
    </footer>

    <!-- Scripts -->
    <!--
    <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.4.1.min.js"></script>
    -->
    <script type="text/javascript" src="https://blog.shadowgears.com/theme/jquery/jquery-3.4.1.min.js"></script>
    <!--
    <script src="https://ajax.aspnetcdn.com/ajax/bootstrap/4.3.1/bootstrap.min.js"></script>
    -->
    <script type="text/javascript" src="https://blog.shadowgears.com/theme/bootstrap/bootstrap.min.js"></script>
    <!--
    <script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script>
    -->
        <script type="text/javascript" src="https://blog.shadowgears.com/theme/extra/bootstrap-toc.min.js"></script>
    <script type="text/javascript" src="https://blog.shadowgears.com/theme/style.js"></script>

    <!-- Sharing -->

    <!-- JSON LD -->
<script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "BlogPosting",
    "name": "Building the Blog",
    "headline": "Building the Blog",
    "datePublished": "2021-04-11 02:10:00-04:00",
    "dateModified": "",
    "author": {
        "@type": "Person",
        "name": "Garrett McGrath",
        "url": "https://blog.shadowgears.com/author/garrett-mcgrath.html"
    },
    "image": "https://blog.shadowgears.com/favicon.ico",
    "url": "https://blog.shadowgears.com/building-the-blog.html",
    "description": "A rundown of how this blog is written, stored, and published"
}
</script>
    <!-- Disqus count -->
</body>

</html>